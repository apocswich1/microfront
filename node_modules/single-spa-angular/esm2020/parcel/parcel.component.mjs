import { Component, ElementRef, Input, ChangeDetectionStrategy, } from '@angular/core';
import * as i0 from "@angular/core";
export class ParcelComponent {
    constructor(host) {
        this.host = host;
        this.config = null;
        this.mountParcel = null;
        this.onParcelMount = null;
        this.wrapWith = 'div';
        this.customProps = {};
        this.appendTo = null;
        this.handleError = (error) => console.error(error);
        this.hasError = false;
        this.wrapper = null;
        this.parcel = null;
        this.task = null;
    }
    ngOnChanges() {
        this.scheduleTask("update" /* Update */, () => {
            if (this.parcel !== null && this.parcel.update) {
                return this.parcel.update(this.customProps);
            }
        });
    }
    ngOnInit() {
        this.scheduleTask("mount" /* Mount */, () => {
            if ((typeof ngDevMode === 'undefined' || ngDevMode) && this.mountParcel === null) {
                throw new Error('single-spa-angular: the [mountParcel] binding is required when using the <parcel> component. You can either (1) import mountRootParcel from single-spa or (2) use the mountParcel prop provided to single-spa applications.');
            }
            this.wrapper = document.createElement(this.wrapWith);
            if (this.appendTo !== null) {
                this.appendTo.appendChild(this.wrapper);
            }
            else {
                this.host.nativeElement.appendChild(this.wrapper);
            }
            this.parcel = this.mountParcel(this.config, {
                ...this.customProps,
                domElement: this.wrapper,
            });
            if (this.onParcelMount !== null) {
                this.parcel.mountPromise.then(this.onParcelMount);
            }
            this.unmounted = false;
            return this.parcel.mountPromise;
        });
    }
    ngOnDestroy() {
        this.scheduleTask("unmount" /* Unmount */, () => {
            if (this.parcel !== null && this.parcel.getStatus() === 'MOUNTED') {
                return this.parcel.unmount();
            }
        });
        if (this.wrapper !== null) {
            this.wrapper.parentNode.removeChild(this.wrapper);
        }
        this.unmounted = true;
    }
    scheduleTask(action, task) {
        if (this.hasError && action !== "unmount" /* Unmount */) {
            // In an error state, we don't do anything anymore except for unmounting
            return;
        }
        this.task = (this.task || Promise.resolve())
            .then(() => {
            if (this.unmounted && action !== "unmount" /* Unmount */) {
                // Never do anything once the angular component unmounts
                return;
            }
            return task();
        })
            .catch((error) => {
            this.task = Promise.resolve();
            this.hasError = true;
            if (error?.message) {
                error.message = `During '${action}', parcel threw an error: ${error.message}`;
            }
            if (typeof this.handleError === 'function') {
                this.handleError(error);
            }
            else {
                setTimeout(() => {
                    throw error;
                });
            }
            // No more things to do should be done -- the parcel is in an error state
            throw error;
        });
    }
}
/** @nocollapse */ /** @nocollapse */ ParcelComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: ParcelComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ /** @nocollapse */ ParcelComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.1", type: ParcelComponent, selector: "parcel", inputs: { config: "config", mountParcel: "mountParcel", onParcelMount: "onParcelMount", wrapWith: "wrapWith", customProps: "customProps", appendTo: "appendTo", handleError: "handleError" }, usesOnChanges: true, ngImport: i0, template: '', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.1", ngImport: i0, type: ParcelComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'parcel',
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { config: [{
                type: Input
            }], mountParcel: [{
                type: Input
            }], onParcelMount: [{
                type: Input
            }], wrapWith: [{
                type: Input
            }], customProps: [{
                type: Input
            }], appendTo: [{
                type: Input
            }], handleError: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyY2VsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYnMvc2luZ2xlLXNwYS1hbmd1bGFyL3BhcmNlbC9zcmMvcGFyY2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBSUwsdUJBQXVCLEdBQ3hCLE1BQU0sZUFBZSxDQUFDOztBQWtCdkIsTUFBTSxPQUFPLGVBQWU7SUFlMUIsWUFBb0IsSUFBNkI7UUFBN0IsU0FBSSxHQUFKLElBQUksQ0FBeUI7UUFkeEMsV0FBTSxHQUF3QixJQUFJLENBQUM7UUFDbkMsZ0JBQVcsR0FBbUMsSUFBSSxDQUFDO1FBQ25ELGtCQUFhLEdBQXdCLElBQUksQ0FBQztRQUMxQyxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGdCQUFXLEdBQTRCLEVBQUUsQ0FBQztRQUMxQyxhQUFRLEdBQWdCLElBQUksQ0FBQztRQUM3QixnQkFBVyxHQUFHLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXRELGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsWUFBTyxHQUF1QixJQUFJLENBQUM7UUFDbkMsV0FBTSxHQUFrQixJQUFJLENBQUM7UUFDN0IsU0FBSSxHQUF5QixJQUFJLENBQUM7SUFFVSxDQUFDO0lBRXJELFdBQVc7UUFDVCxJQUFJLENBQUMsWUFBWSx3QkFBZ0IsR0FBRyxFQUFFO1lBQ3BDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7Z0JBQzlDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2FBQzdDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUks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O2FBQ3pCO2lCQUFNO2dCQUNMLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsTUFBTSxLQUFLLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7YUFDSjtZQUVELHlFQUF5RTtZQUN6RSxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7a0pBdkdVLGVBQWU7c0lBQWYsZUFBZSxpUUFIaEIsRUFBRTsyRkFHRCxlQUFlO2tCQUwzQixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxRQUFRO29CQUNsQixRQUFRLEVBQUUsRUFBRTtvQkFDWixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtpQkFDaEQ7aUdBRVUsTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUGFyY2VsLCBQYXJjZWxDb25maWcsIEFwcFByb3BzIH0gZnJvbSAnc2luZ2xlLXNwYSc7XG5cbmNvbnN0IGVudW0gQWN0aW9uIHtcbiAgTW91bnQgPSAnbW91bnQnLFxuICBVcGRhdGUgPSAndXBkYXRlJyxcbiAgVW5tb3VudCA9ICd1bm1vdW50Jyxcbn1cblxuLy8gVGhpcyB3aWxsIGJlIHByb3ZpZGVkIHRocm91Z2ggVGVyc2VyIGdsb2JhbCBkZWZpbml0aW9ucyBieSBBbmd1bGFyIENMSS4gVGhpcyB3aWxsXG4vLyBoZWxwIHRvIHRyZWUtc2hha2UgYXdheSB0aGUgY29kZSB1bm5lZWRlZCBmb3IgcHJvZHVjdGlvbiBidW5kbGVzLlxuZGVjbGFyZSBjb25zdCBuZ0Rldk1vZGU6IGJvb2xlYW47XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BhcmNlbCcsXG4gIHRlbXBsYXRlOiAnJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIFBhcmNlbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBjb25maWc6IFBhcmNlbENvbmZpZyB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSBtb3VudFBhcmNlbDogQXBwUHJvcHNbJ21vdW50UGFyY2VsJ10gfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCkgb25QYXJjZWxNb3VudDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIEBJbnB1dCgpIHdyYXBXaXRoID0gJ2Rpdic7XG4gIEBJbnB1dCgpIGN1c3RvbVByb3BzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuICBASW5wdXQoKSBhcHBlbmRUbzogTm9kZSB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSBoYW5kbGVFcnJvciA9IChlcnJvcjogRXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXG4gIHByaXZhdGUgaGFzRXJyb3IgPSBmYWxzZTtcbiAgcHJpdmF0ZSB1bm1vdW50ZWQ/OiBib29sZWFuO1xuICBwcml2YXRlIHdyYXBwZXI6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcGFyY2VsOiBQYXJjZWwgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB0YXNrOiBQcm9taXNlPHZvaWQ+IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBob3N0OiBFbGVtZW50UmVmPEhUTUxFbGVtZW50Pikge31cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLnNjaGVkdWxlVGFzayhBY3Rpb24uVXBkYXRlLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5wYXJjZWwgIT09IG51bGwgJiYgdGhpcy5wYXJjZWwudXBkYXRlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmNlbC51cGRhdGUodGhpcy5jdXN0b21Qcm9wcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnNjaGVkdWxlVGFzayhBY3Rpb24uTW91bnQsICgpID0+IHtcbiAgICAgIGlmICgodHlwZW9mIG5nRGV2TW9kZSA9PT0gJ3VuZGVmaW5lZCcgfHwgbmdEZXZNb2RlKSAmJiB0aGlzLm1vdW50UGFyY2VsID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnc2luZ2xlLXNwYS1hbmd1bGFyOiB0aGUgW21vdW50UGFyY2VsXSBiaW5kaW5nIGlzIHJlcXVpcmVkIHdoZW4gdXNpbmcgdGhlIDxwYXJjZWw+IGNvbXBvbmVudC4gWW91IGNhbiBlaXRoZXIgKDEpIGltcG9ydCBtb3VudFJvb3RQYXJjZWwgZnJvbSBzaW5nbGUtc3BhIG9yICgyKSB1c2UgdGhlIG1vdW50UGFyY2VsIHByb3AgcHJvdmlkZWQgdG8gc2luZ2xlLXNwYSBhcHBsaWNhdGlvbnMuJyxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy53cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLndyYXBXaXRoKTtcblxuICAgICAgaWYgKHRoaXMuYXBwZW5kVG8gIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5hcHBlbmRUby5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ob3N0Lm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy53cmFwcGVyKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wYXJjZWwgPSB0aGlzLm1vdW50UGFyY2VsISh0aGlzLmNvbmZpZyEsIHtcbiAgICAgICAgLi4udGhpcy5jdXN0b21Qcm9wcyxcbiAgICAgICAgZG9tRWxlbWVudDogdGhpcy53cmFwcGVyLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICh0aGlzLm9uUGFyY2VsTW91bnQgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5wYXJjZWwubW91bnRQcm9taXNlLnRoZW4odGhpcy5vblBhcmNlbE1vdW50KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy51bm1vdW50ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzLnBhcmNlbC5tb3VudFByb21pc2U7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnNjaGVkdWxlVGFzayhBY3Rpb24uVW5tb3VudCwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucGFyY2VsICE9PSBudWxsICYmIHRoaXMucGFyY2VsLmdldFN0YXR1cygpID09PSAnTU9VTlRFRCcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyY2VsLnVubW91bnQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmICh0aGlzLndyYXBwZXIgIT09IG51bGwpIHtcbiAgICAgIHRoaXMud3JhcHBlci5wYXJlbnROb2RlIS5yZW1vdmVDaGlsZCh0aGlzLndyYXBwZXIpO1xuICAgIH1cblxuICAgIHRoaXMudW5tb3VudGVkID0gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgc2NoZWR1bGVUYXNrKGFjdGlvbjogQWN0aW9uLCB0YXNrOiAoKSA9PiB2b2lkIHwgUHJvbWlzZTxhbnk+KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFzRXJyb3IgJiYgYWN0aW9uICE9PSBBY3Rpb24uVW5tb3VudCkge1xuICAgICAgLy8gSW4gYW4gZXJyb3Igc3RhdGUsIHdlIGRvbid0IGRvIGFueXRoaW5nIGFueW1vcmUgZXhjZXB0IGZvciB1bm1vdW50aW5nXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy50YXNrID0gKHRoaXMudGFzayB8fCBQcm9taXNlLnJlc29sdmUoKSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMudW5tb3VudGVkICYmIGFjdGlvbiAhPT0gQWN0aW9uLlVubW91bnQpIHtcbiAgICAgICAgICAvLyBOZXZlciBkbyBhbnl0aGluZyBvbmNlIHRoZSBhbmd1bGFyIGNvbXBvbmVudCB1bm1vdW50c1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXNrKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcjogRXJyb3IpID0+IHtcbiAgICAgICAgdGhpcy50YXNrID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIHRoaXMuaGFzRXJyb3IgPSB0cnVlO1xuXG4gICAgICAgIGlmIChlcnJvcj8ubWVzc2FnZSkge1xuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSBgRHVyaW5nICcke2FjdGlvbn0nLCBwYXJjZWwgdGhyZXcgYW4gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmhhbmRsZUVycm9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIG1vcmUgdGhpbmdzIHRvIGRvIHNob3VsZCBiZSBkb25lIC0tIHRoZSBwYXJjZWwgaXMgaW4gYW4gZXJyb3Igc3RhdGVcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcbiAgfVxufVxuIl19